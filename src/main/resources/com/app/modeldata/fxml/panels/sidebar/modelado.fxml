<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.LineChart?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Spinner?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.text.Text?>
<?import javafx.scene.shape.Circle?>

<?import javafx.scene.layout.AnchorPane?>

<AnchorPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.app.controllers.panels.sidebar.ModeladoController">
    <ScrollPane fitToWidth="true" AnchorPane.topAnchor="0.0" AnchorPane.bottomAnchor="0.0" AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0">
    <VBox spacing="25.0" styleClass="main-container">
        <padding>
            <Insets bottom="30.0" left="30.0" right="30.0" top="30.0" />
        </padding>

        <!-- Título del Módulo -->
        <Text text="%modelado.titulo" styleClass="page-title" />

        <!-- Sección A: Selección de Segmentación -->
        <VBox spacing="15.0" styleClass="card">
            <Text text="%modelado.seccion.segmentacion" styleClass="section-title" />
            
            <!-- Tipo de segmentación -->
            <HBox spacing="10.0" alignment="CENTER_LEFT">
                <Label text="%modelado.label.tipoSegmentacion" minWidth="120.0" />
                <ComboBox fx:id="comboTipoSegmentacion" minWidth="200.0" />
            </HBox>
            
            <!-- Categoría específica -->
            <HBox spacing="10.0" alignment="CENTER_LEFT">
                <Label text="%modelado.label.categoria" minWidth="120.0" />
                <ComboBox fx:id="comboCategoria" minWidth="200.0" />
            </HBox>
        </VBox>

        <!-- Sección B: Rango Temporal -->
        <VBox spacing="15.0" styleClass="card">
            <Text text="%modelado.seccion.rangoTemporal" styleClass="section-title" />
            
            <!-- Año inicial -->
            <HBox spacing="10.0" alignment="CENTER_LEFT">
                <Label text="%modelado.label.anioInicial" minWidth="120.0" />
                <ComboBox fx:id="comboAnioInicial" minWidth="100.0" />
            </HBox>
            
            <!-- Año final -->
            <HBox spacing="10.0" alignment="CENTER_LEFT">
                <Label text="%modelado.label.anioFinal" minWidth="120.0" />
                <ComboBox fx:id="comboAnioFinal" minWidth="100.0" />
            </HBox>
            
            <!-- Intervalo -->
            <HBox spacing="10.0" alignment="CENTER_LEFT">
                <Label text="%modelado.label.intervalo" minWidth="120.0" />
                <Spinner fx:id="spinnerIntervalo" editable="true" minWidth="100.0" />
            </HBox>
        </VBox>

        <!-- Sección C: Ejecución -->
        <HBox spacing="15.0" alignment="CENTER">
            <Button fx:id="btnAplicarModelado" text="%modelado.button.aplicarModeladoEDO" onAction="#onAplicarModelado" styleClass="primary-button" />
            <Button fx:id="btnLimpiar" text="%modelado.button.limpiar" onAction="#onLimpiar" styleClass="secondary-button" />
        </HBox>

        <!-- Sección D: Resultados (Gráfica + Métricas) -->
        <VBox spacing="20.0" styleClass="card" fx:id="panelResultados" visible="false" managed="false">
            <Text text="%modelado.seccion.resultados" styleClass="section-title" />
            
            <!-- Subsección: Gráfica Integrada -->
            <VBox spacing="10.0">
                <Text text="%modelado.label.grafica" styleClass="subtitle" />
                <StackPane fx:id="contenedorGrafica" minHeight="400.0" styleClass="chart-container">
                    <LineChart fx:id="chartModelado" animated="false" legendVisible="false">
                        <xAxis>
                            <NumberAxis label="%modelado.chart.xaxis" side="BOTTOM" />
                        </xAxis>
                        <yAxis>
                            <NumberAxis label="%modelado.chart.yaxis" side="LEFT" />
                        </yAxis>
                    </LineChart>
                </StackPane>
                <!-- Leyenda manual -->
                <HBox spacing="15.0" alignment="CENTER">
                    <HBox spacing="5.0" alignment="CENTER_LEFT">
                        <Circle radius="5.0" fill="blue" stroke="blue" />
                        <Label text="%modelado.leyenda.datosReales" />
                    </HBox>
                    <HBox spacing="5.0" alignment="CENTER_LEFT">
                        <Circle radius="5.0" fill="red" stroke="red" />
                        <Label text="%modelado.leyenda.datosModelados" />
                    </HBox>
                </HBox>
            </VBox>
            
            <!-- Subsección: Métricas del Modelo -->
            <VBox spacing="10.0">
                <Text text="%modelado.label.metricas" styleClass="subtitle" />
                <GridPane hgap="15.0" vgap="10.0" styleClass="metrics-grid">
                    <!-- Ecuación -->
                    <Label text="%modelado.label.ecuacion" styleClass="metric-label" GridPane.rowIndex="0" GridPane.columnIndex="0" />
                    <Label fx:id="lblEcuacion" styleClass="metric-value" GridPane.rowIndex="0" GridPane.columnIndex="1" GridPane.columnSpan="2" />
                    
                    <!-- Parámetro A -->
                    <Label text="%modelado.label.parametroA" styleClass="metric-label" GridPane.rowIndex="1" GridPane.columnIndex="0" />
                    <Label fx:id="lblParametroA" styleClass="metric-value" GridPane.rowIndex="1" GridPane.columnIndex="1" />
                    
                    <!-- Parámetro B -->
                    <Label text="%modelado.label.parametroB" styleClass="metric-label" GridPane.rowIndex="2" GridPane.columnIndex="0" />
                    <HBox spacing="10.0" alignment="CENTER_LEFT" GridPane.rowIndex="2" GridPane.columnIndex="1">
                        <Label fx:id="lblParametroB" styleClass="metric-value" />
                        <Label fx:id="lblTipoCrecimiento" styleClass="badge" />
                    </HBox>
                    
                    <!-- R² -->
                    <Label text="R²" styleClass="metric-label" GridPane.rowIndex="3" GridPane.columnIndex="0" />
                    <Label fx:id="lblR2" styleClass="metric-value" GridPane.rowIndex="3" GridPane.columnIndex="1" />
                    
                    <!-- MAE -->
                    <Label text="MAE" styleClass="metric-label" GridPane.rowIndex="4" GridPane.columnIndex="0" />
                    <Label fx:id="lblMAE" styleClass="metric-value" GridPane.rowIndex="4" GridPane.columnIndex="1" />
                    
                    <!-- RMSE -->
                    <Label text="RMSE" styleClass="metric-label" GridPane.rowIndex="5" GridPane.columnIndex="0" />
                    <Label fx:id="lblRMSE" styleClass="metric-value" GridPane.rowIndex="5" GridPane.columnIndex="1" />
                </GridPane>
            </VBox>
        </VBox>
    </VBox>
</ScrollPane>
</AnchorPane>
