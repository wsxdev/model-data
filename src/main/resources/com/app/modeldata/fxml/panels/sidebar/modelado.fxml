<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.LineChart?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Spinner?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.text.Text?>
<?import javafx.scene.shape.Circle?>

<?import javafx.scene.layout.AnchorPane?>
<?import org.controlsfx.control.CheckComboBox?>

<AnchorPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.app.controllers.panels.sidebar.ModeladoController">
    <ScrollPane fitToWidth="true" AnchorPane.topAnchor="0.0" AnchorPane.bottomAnchor="0.0" AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0">
    <VBox spacing="25.0" styleClass="main-container">
        <padding>
            <Insets bottom="30.0" left="30.0" right="30.0" top="30.0" />
        </padding>

        <!-- Título del Módulo -->
        <Text text="%modelado.titulo" styleClass="page-title" />

        <!-- Sección A: Selección de Segmentación y Comparación -->
        <VBox spacing="15.0" styleClass="card">
            <Text text="%modelado.seccion.segmentacion" styleClass="section-title" />
            
            <!-- Tipo de segmentación -->
            <HBox spacing="10.0" alignment="CENTER_LEFT">
                <Label text="%modelado.label.tipoSegmentacion" minWidth="150.0" />
                <ComboBox fx:id="comboTipoSegmentacion" minWidth="250.0" />
            </HBox>

            <!-- Modo de Comparación -->
            <HBox spacing="10.0" alignment="CENTER_LEFT">
                <Label text="%modelado.label.modoComparacion" minWidth="150.0" />
                <ComboBox fx:id="comboModoComparacion" minWidth="250.0" />
            </HBox>
            
            <!-- Categoría Principal -->
            <HBox spacing="10.0" alignment="CENTER_LEFT">
                <Label text="%modelado.label.categoria" minWidth="150.0" />
                <ComboBox fx:id="comboCategoria" minWidth="250.0" />
            </HBox>

            <!-- Categoría Secundaria (Para 1 vs 1) -->
            <HBox fx:id="boxCategoria2" spacing="10.0" alignment="CENTER_LEFT" visible="false" managed="false">
                <Label text="%modelado.label.categoria2" minWidth="150.0" />
                <ComboBox fx:id="comboCategoria2" minWidth="250.0" />
            </HBox>

            <!-- Categorías Múltiples (Para 1 vs N) -->
            <HBox fx:id="boxCategoriaMulti" spacing="10.0" alignment="CENTER_LEFT" visible="false" managed="false">
                <Label text="%modelado.label.categoriasMulti" minWidth="150.0" />
                <CheckComboBox fx:id="checkComboCategoriaMulti" minWidth="250.0" maxWidth="300.0"/>
            </HBox>
        </VBox>

        <!-- Sección B: Rango Temporal -->
        <VBox spacing="15.0" styleClass="card">
            <Text text="%modelado.seccion.rangoTemporal" styleClass="section-title" />
            
            <!-- Año inicial -->
            <HBox spacing="10.0" alignment="CENTER_LEFT">
                <Label text="%modelado.label.anioInicial" minWidth="120.0" />
                <ComboBox fx:id="comboAnioInicial" minWidth="100.0" />
            </HBox>
            
            <!-- Año final -->
            <HBox spacing="10.0" alignment="CENTER_LEFT">
                <Label text="%modelado.label.anioFinal" minWidth="120.0" />
                <ComboBox fx:id="comboAnioFinal" minWidth="100.0" />
            </HBox>
            
            <!-- Intervalo -->
            <HBox spacing="10.0" alignment="CENTER_LEFT">
                <Label text="%modelado.label.intervalo" minWidth="120.0" />
                <Spinner fx:id="spinnerIntervalo" editable="true" minWidth="100.0" />
            </HBox>
        </VBox>

        <!-- Sección C: Ejecución -->
        <HBox spacing="15.0" alignment="CENTER">
            <Button fx:id="btnModelar" text="%modelado.button.modelar" onAction="#onModelar" styleClass="primary-button" />
            <Button fx:id="btnGraficar" text="%modelado.button.graficar" onAction="#onGraficar" styleClass="action-button" disable="true"/>
            <Button fx:id="btnLimpiar" text="%modelado.button.limpiar" onAction="#onLimpiar" styleClass="secondary-button" />
        </HBox>

        <!-- Sección D: Resultados (Gráfica + Métricas) -->
        <VBox spacing="20.0" styleClass="card" fx:id="panelResultados" visible="false" managed="false">
            <Text text="%modelado.seccion.resultados" styleClass="section-title" />
            
            <!-- Subsección: Gráfica Integrada -->
            <VBox spacing="10.0">
                <Text text="%modelado.label.grafica" styleClass="subtitle" />
                <StackPane fx:id="contenedorGrafica" minHeight="400.0" styleClass="chart-container">
                    <LineChart fx:id="chartModelado" animated="false" legendVisible="true">
                        <xAxis>
                            <NumberAxis label="%modelado.chart.xaxis" side="BOTTOM" />
                        </xAxis>
                        <yAxis>
                            <NumberAxis label="%modelado.chart.yaxis" side="LEFT" />
                        </yAxis>
                    </LineChart>
                </StackPane>
            </VBox>
            
            <!-- Subsección: Análisis Comparativo (Tabla + Texto) -->
            <VBox fx:id="boxMetricas" spacing="10.0" VBox.vgrow="ALWAYS">
                <Text text="%modelado.label.analisis" styleClass="subtitle" />
                
                <TableView fx:id="tblAnalisis" prefHeight="200.0">

                    <placeholder>
                        <Label text="%modelado.table.placeholder"/>
                    </placeholder>
                    <columns>
                        <TableColumn fx:id="colCategoria" text="%modelado.column.categoria" minWidth="250.0" />
                        <TableColumn fx:id="colEcuacion" text="%modelado.column.ecuacion" minWidth="300.0" />
                        <TableColumn fx:id="colParametroA" text="%modelado.column.paramA" minWidth="150.0" />
                        <TableColumn fx:id="colParametroB" text="%modelado.column.paramB" minWidth="150.0" />
                        <TableColumn fx:id="colR2" text="%modelado.column.r2" minWidth="100.0" />
                        <TableColumn fx:id="colMAE" text="%modelado.column.mae" minWidth="100.0" />
                        <TableColumn fx:id="colRMSE" text="%modelado.column.rmse" minWidth="100.0" />
                        <TableColumn fx:id="colInterpretacion" text="%modelado.column.interpretacion" minWidth="250.0" />
                    </columns>
                </TableView>
                
                <!-- Análisis Textual Automático -->
                <Label fx:id="lblAnalisisTexto" wrapText="true" styleClass="analysis-label" 
                       text="%modelado.label.analisis.placeholder" />
            </VBox>
        </VBox>
    </VBox>
</ScrollPane>
</AnchorPane>
